<div class="p-4 pt-2">
  <div class="d-flex align-items-center gap-3 mb-2">
    <h3 class="fs-5 fw-bold text-primary mb-0 py-2">Audit Log</h3>
  </div>

  <mat-card appearance="raised">
    <mat-card-content class="py-4 px-0 mx-3 my-0">
      <div class="mat-elevation-z8">
        <table mat-table [dataSource]="auditLogDataSource" matSort>
          <ng-container matColumnDef="createdAt">
            <th mat-header-cell *matHeaderCellDef class="fw-semibold text-primary">
              <span mat-sort-header>Created At</span>
              <mat-form-field appearance="outline" class="column-filter">
                <input matInput [matDatepicker]="createdAtPicker" (dateChange)="applyDateFilter('createdAt', $event)"
                  placeholder="Filter by date" />
                <mat-datepicker-toggle matSuffix [for]="createdAtPicker"></mat-datepicker-toggle>
                <mat-datepicker #createdAtPicker></mat-datepicker>
              </mat-form-field>
            </th>
            <td mat-cell *matCellDef="let row">{{ row.createdAt | dateFormat }}</td>
          </ng-container>

          <ng-container matColumnDef="sessionId">
            <th mat-header-cell *matHeaderCellDef class="fw-semibold text-primary">
              <span mat-sort-header>Session ID</span>
              <mat-form-field appearance="outline" class="column-filter">
                <input matInput (keyup)="applyColumnFilter('sessionId', $event)" placeholder="Filter" />
              </mat-form-field>
            </th>
            <td mat-cell *matCellDef="let row">{{ row.sessionId }}</td>
          </ng-container>

          <ng-container matColumnDef="actorId">
            <th mat-header-cell *matHeaderCellDef class="fw-semibold text-primary">
              <span mat-sort-header>User ID</span>
              <mat-form-field appearance="outline" class="column-filter">
                <input matInput (keyup)="applyColumnFilter('actorId', $event)" placeholder="Filter" />
              </mat-form-field>
            </th>
            <td mat-cell *matCellDef="let row">
              <div class="my-1">{{ row.actorId }}</div>
          </ng-container>

          <ng-container matColumnDef="actor">
            <th mat-header-cell *matHeaderCellDef class="fw-semibold text-primary">
              <span mat-sort-header>User</span>
              <mat-form-field appearance="outline" class="column-filter">
                <input matInput (keyup)="applyColumnFilter('actorName', $event)" placeholder="Filter" />
              </mat-form-field>
            </th>
            <td mat-cell *matCellDef="let row">
              <div class="my-1">{{ row.actorName }}</div>
            </td>
          </ng-container>

          <ng-container matColumnDef="action">
            <th mat-header-cell *matHeaderCellDef class="fw-semibold text-primary">
              <span mat-sort-header>Action</span>
              <mat-form-field appearance="outline" class="column-filter">
                <input matInput (keyup)="applyColumnFilter('action', $event)" placeholder="Filter" />
              </mat-form-field>
            </th>
            <td mat-cell *matCellDef="let row">{{ row.action }}</td>
          </ng-container>

          <ng-container matColumnDef="targetId">
            <th mat-header-cell *matHeaderCellDef class="fw-semibold text-primary">
              <span mat-sort-header>Target ID</span>
              <mat-form-field appearance="outline" class="column-filter">
                <input matInput (keyup)="applyColumnFilter('targetId', $event)" placeholder="Filter" />
              </mat-form-field>
            </th>
            <td mat-cell *matCellDef="let row">
              <div class="my-1">{{ row.targetId }}</div>
            </td>
          </ng-container>

          <ng-container matColumnDef="targetType">
            <th mat-header-cell *matHeaderCellDef class="fw-semibold text-primary">
              <span mat-sort-header>Target Type</span>
              <mat-form-field appearance="outline" class="column-filter">
                <input matInput (keyup)="applyColumnFilter('targetType', $event)" placeholder="Filter" />
              </mat-form-field>
            </th>
            <td mat-cell *matCellDef="let row">
              <div class="my-1">{{ row.targetType }}</div>
            </td>
          </ng-container>

          <ng-container matColumnDef="target">
            <th mat-header-cell *matHeaderCellDef class="fw-semibold text-primary">
              <span mat-sort-header>Target</span>
              <mat-form-field appearance="outline" class="column-filter">
                <input matInput (keyup)="applyColumnFilter('target', $event)" placeholder="Filter" />
              </mat-form-field>
            </th>
            <td mat-cell *matCellDef="let row">
              <div class="my-1 fw-semibold">{{ row.target }}</div>
            </td>
          </ng-container>

          <ng-container matColumnDef="changes">
            <th mat-header-cell *matHeaderCellDef class="fw-semibold text-primary">
              <span mat-sort-header>Changes</span>
              <mat-form-field appearance="outline" class="column-filter">
                <input matInput (keyup)="applyColumnFilter('changes', $event)" placeholder="Filter" />
              </mat-form-field>
            </th>
            <td mat-cell *matCellDef="let row">
              <ng-container *ngIf="row.changes; else noData">
                <div class="my-1" *ngFor="let key of getKeys(row.changes)">
                  <strong>{{ key }}:</strong> {{ row.changes[key] }}
                </div>
              </ng-container>
              <ng-template #noData>N/A</ng-template>
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="auditLogColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: auditLogColumns"></tr>

          <tr class="mat-row" *matNoDataRow>
            <td class="mat-cell" colspan="6">No audit logs available.</td>
          </tr>
        </table>

        <mat-paginator class="mt-3" [pageSizeOptions]="[10, 25, 50]" [showFirstLastButtons]="true"
          aria-label="Select page of logs"></mat-paginator>
      </div>
    </mat-card-content>
  </mat-card>
</div>